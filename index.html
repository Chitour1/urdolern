<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­ÙƒØ§ÙŠØªÙŠ Ø§Ù„Ø£Ø±Ø¯ÙŠØ© - ØªØ¹Ù„Ù… Ø§Ù„Ø£Ø±Ø¯ÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Noto+Nastaliq+Urdu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        .font-urdu {
            font-family: 'Noto Nastaliq Urdu', serif;
        }
        .lesson-content b, .lesson-content .word-span {
             cursor: pointer;
        }
        .lesson-content b:hover, .lesson-content .word-span:hover {
            background-color: #e0f2fe;
        }
        .dialogue-line {
            margin-bottom: 1.5rem;
        }
        .dialogue-speaker-1 { color: #1d4ed8; font-weight: bold; }
        .dialogue-speaker-2 { color: #be185d; font-weight: bold; }
        .loader {
            border: 5px solid #f3f3f3; border-top: 5px solid #3498db;
            border-radius: 50%; width: 50px; height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.5); display: flex;
            align-items: center; justify-content: center; z-index: 1000;
        }
        .modal-content {
            background: white; padding: 2rem; border-radius: 8px;
            max-width: 90%; width: 450px; text-align: center;
        }
        .table-style { width: 100%; border-collapse: collapse; }
        .table-style th, .table-style td {
            border: 1px solid #e2e8f0;
            padding: 12px; 
            text-align: right;
        }
        .table-style th { background-color: #f1f5f9; }
        .table-style td:first-child {
            font-weight: bold; font-family: 'Noto Nastaliq Urdu', serif;
        }
        /* Flashcard styles */
        .flashcard-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; }
        .flashcard {
            background-color: white; border: 1px solid #e2e8f0; border-radius: 8px;
            height: 100px; 
            perspective: 1000px; cursor: pointer;
        }
        .flashcard-inner {
            position: relative; width: 100%; height: 100%; text-align: center;
            transition: transform 0.6s; transform-style: preserve-3d;
        }
        .flashcard.is-flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back {
            position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden;
            backface-visibility: hidden; display: flex; align-items: center; justify-content: center;
            padding: 1rem; font-size: 1.2rem;
        }
        .flashcard-front { font-family: 'Noto Nastaliq Urdu', serif; }
        .flashcard-back { transform: rotateY(180deg); background-color: #f0f9ff; }
        /* Matching exercise styles */
        .matching-container { display: flex; justify-content: space-around; gap: 1rem; }
        .matching-column { display: flex; flex-direction: column; gap: 0.5rem; flex: 1; }
        .match-item {
            padding: 0.75rem; 
            border: 2px solid #cbd5e1; border-radius: 6px;
            cursor: pointer; transition: all 0.2s; font-size: 1.1rem;
        }
        .match-item.selected { border-color: #3b82f6; background-color: #dbeafe; }
        .match-item.correct { border-color: #22c55e; background-color: #dcfce7; pointer-events: none; }
        .match-item.incorrect { border-color: #ef4444; background-color: #fee2e2; }
        .exercise {
            margin-bottom: 1rem; 
        }
        /* Alphabet styles */
        .alphabet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 0.75rem;
            direction: rtl;
        }
        .letter-card {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 70px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .letter-card:hover {
            background-color: #e0f2fe;
            border-color: #3b82f6;
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="app" class="container mx-auto p-4 md:p-8 max-w-4xl">
        
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-sky-600 mb-2 font-urdu">Ø­Ú©Ø§ÛŒØªÛŒ Ø§Ù„Ø£Ø±Ø¯ÛŒØ©</h1>
            <p class="text-lg text-slate-600">ØªØ¹Ù„Ù… Ù…ÙØ±Ø¯Ø§Øª Ø§Ù„Ø£Ø±Ø¯ÙŠØ© Ù…Ù† Ø®Ù„Ø§Ù„ Ù‚ØµØµ ÙŠØµÙ†Ø¹Ù‡Ø§ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</p>
        </header>

        <div id="api-key-section" class="mb-6 p-4 bg-white rounded-lg shadow-md">
            <div class="flex items-center gap-3 mb-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-amber-500"><path d="M14 9a2 2 0 0 1-2 2H6l-4 4V4c0-1.1.9-2 2-2h8a2 2 0 0 1 2 2v5Z"/><path d="M18 9h2a2 2 0 0 1 2 2v10l-4-4H8a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h2"/><path d="M22 12h-2"/><path d="M18 12h-2"/></svg>
                <h2 class="text-xl font-bold">Ù…ÙØªØ§Ø­ Gemini API</h2>
            </div>
            <p class="text-slate-600 mb-3 text-sm">Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ Gemini API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„ÙŠÙ‡ Ù…Ù† <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-sky-600 hover:underline">Google AI Studio</a>.</p>
            <div class="flex flex-col sm:flex-row gap-2">
                <input type="password" id="api-key-input" class="flex-grow p-2 border rounded-md" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙØªØ§Ø­Ùƒ Ù‡Ù†Ø§...">
                <button id="save-api-key-btn" class="bg-sky-600 text-white px-6 py-2 rounded-md hover:bg-sky-700 transition">Ø­ÙØ¸ ÙˆØ¨Ø¯Ø¡</button>
            </div>
        </div>

        <main id="main-content" class="hidden">
            
            <div class="mb-6 flex justify-center border-b flex-wrap">
                <button id="nav-home" class="px-4 py-3 text-lg font-bold border-b-4 border-sky-600 text-sky-600">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                <button id="nav-alphabet" class="px-4 py-3 text-lg font-bold border-b-4 border-transparent text-slate-500 hover:text-sky-600">Ø§Ù„Ø­Ø±ÙˆÙ</button>
                <button id="nav-history" class="px-4 py-3 text-lg font-bold border-b-4 border-transparent text-slate-500 hover:text-sky-600">Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø±ÙˆØ³</button>
                <button id="nav-learned" class="px-4 py-3 text-lg font-bold border-b-4 border-transparent text-slate-500 hover:text-sky-600">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªØ¹Ù„Ù…Ø©</button>
                <button id="nav-basket" class="px-4 py-3 text-lg font-bold border-b-4 border-transparent text-slate-500 hover:text-sky-600">Ø³Ù„Ø© Ø§Ù„ØªØ¹Ù„Ù…</button>
            </div>
            
            <div id="stats-section" class="mb-6 p-4 bg-white rounded-lg shadow-md flex flex-wrap justify-around text-center">
                <div><p class="text-slate-500">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</p><p id="total-words" class="text-2xl font-bold text-sky-600">0</p></div>
                <div><p class="text-slate-500">ÙƒÙ„Ù…Ø§Øª ØªØ¹Ù„Ù…ØªÙ‡Ø§</p><p id="learned-words" class="text-2xl font-bold text-green-600">0</p></div>
                <div><p class="text-slate-500">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</p><p id="remaining-words" class="text-2xl font-bold text-amber-600">0</p></div>
            </div>

            <div id="home-screen" class="text-center p-8 bg-white rounded-lg shadow-md">
                <h2 class="text-2xl font-bold mb-4">Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ù„Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯ØŸ</h2>
                <p class="text-slate-600 mb-6">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„ÙŠÙ‚ÙˆÙ… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù‚ØµØ© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ùƒ Ù…Ù† 15-20 ÙƒÙ„Ù…Ø© Ù„Ù… ØªØªØ¹Ù„Ù…Ù‡Ø§ Ø¨Ø¹Ø¯.</p>
                <button id="new-lesson-btn" class="bg-green-600 text-white px-8 py-3 rounded-lg text-lg font-bold hover:bg-green-700 transition transform hover:scale-105">
                    <span class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
                        Ø£Ù†Ø´Ø¦ Ù‚ØµØ© Ø¬Ø¯ÙŠØ¯Ø©
                    </span>
                </button>
                <button id="reset-progress-btn" class="mt-4 bg-red-500 text-white px-4 py-2 rounded-md text-sm hover:bg-red-600 transition">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªÙ‚Ø¯Ù…</button>
            </div>

            <div id="alphabet-screen" class="hidden p-4 bg-white rounded-lg shadow-md"></div>
            
            <div id="history-screen" class="hidden p-4 bg-white rounded-lg shadow-md space-y-3">
                <h2 class="text-2xl font-bold mb-4 text-center">Ø§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h2>
                <div id="history-list" class="space-y-2"></div>
            </div>

            <div id="learned-words-screen" class="hidden p-4 bg-white rounded-lg shadow-md"></div>
            
            <div id="basket-screen" class="hidden space-y-6"></div>

            <div id="loading-screen" class="hidden text-center p-8 bg-white rounded-lg shadow-md">
                <div class="flex justify-center mb-4"><div class="loader"></div></div>
                <p class="text-slate-600 text-lg">Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ÙŠØ¹Ù…Ù„... ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.</p>
            </div>

            <div id="lesson-screen" class="hidden space-y-6"></div>
        </main>

        <div id="selection-popup" class="hidden absolute bg-white border rounded-lg shadow-xl p-1 flex gap-1 z-50">
            <button id="popup-translate" title="ØªØ±Ø¬Ù…Ø©" class="p-2 hover:bg-slate-100 rounded-md">ğŸ‡µğŸ‡°</button>
            <button id="popup-speak" title="Ù†Ø·Ù‚" class="p-2 hover:bg-slate-100 rounded-md">ğŸ”Š</button>
            <button id="popup-phonetics" title="ÙƒØªØ§Ø¨Ø© ØµÙˆØªÙŠØ©" class="p-2 hover:bg-slate-100 rounded-md">ğŸ—£ï¸</button>
            <button id="popup-save" title="Ø­ÙØ¸ Ù„Ù„Ø³Ù„Ø©" class="p-2 hover:bg-slate-100 rounded-md">ğŸ’¾</button>
        </div>
    </div>

    <script>
        const urduAlphabet = ['Ø§', 'Ø¨', 'Ù¾', 'Øª', 'Ù¹', 'Ø«', 'Ø¬', 'Ú†', 'Ø­', 'Ø®', 'Ø¯', 'Úˆ', 'Ø°', 'Ø±', 'Ú‘', 'Ø²', 'Ú˜', 'Ø³', 'Ø´', 'Øµ', 'Ø¶', 'Ø·', 'Ø¸', 'Ø¹', 'Øº', 'Ù', 'Ù‚', 'Ú©', 'Ú¯', 'Ù„', 'Ù…', 'Ù†', 'Úº', 'Ùˆ', 'Û', 'Ú¾', 'Ø¡', 'ÛŒ', 'Û’'];
        const a1UrduWords = [
            'Ù…ÛŒÚº', 'ØªÙ…', 'Ø¢Ù¾', 'ÛŒÛ', 'ÙˆÛ', 'ÛÙ…', 'Ú©ÙˆÙ†', 'Ú©ÛŒØ§', 'Ú©ÛØ§Úº', 'Ú©Ø¨', 'Ú©ÛŒØ³Û’', 'Ú©ÛŒÙˆÚº', 'Ù…ÛŒØ±Ø§', 'ØªÙ…ÛØ§Ø±Ø§', 'Ø¢Ù¾Ú©Ø§', 'Ø§Ø³Ú©Ø§', 'ÛÙ…Ø§Ø±Ø§', 'Ø§Ù†Ú©Ø§', 'Ú©ÙˆØ¦ÛŒ', 'Ø³Ø¨', 'ÛØ± Ú©ÙˆØ¦ÛŒ',
            'Ø¢Ø¯Ù…ÛŒ', 'Ø¹ÙˆØ±Øª', 'Ù„Ú‘Ú©Ø§', 'Ù„Ú‘Ú©ÛŒ', 'Ø¨Ú†Û', 'Ø¨Ú†Û’', 'Ø¯ÙˆØ³Øª', 'Ø¯Ø´Ù…Ù†', 'Ø®Ø§Ù†Ø¯Ø§Ù†', 'ÙˆØ§Ù„Ø¯', 'ÙˆØ§Ù„Ø¯Û', 'Ù…Ø§Úº', 'Ø¨Ø§Ù¾', 'Ø¨Ú¾Ø§Ø¦ÛŒ', 'Ø¨ÛÙ†', 'Ø´ÙˆÛØ±', 'Ø¨ÛŒÙˆÛŒ', 'Ø¨ÛŒÙ¹Ø§', 'Ø¨ÛŒÙ¹ÛŒ', 'Ù„ÙˆÚ¯', 'Ø±Ø´ØªÛ’ Ø¯Ø§Ø±',
            'Ø¯Ø§Ø¯Ø§', 'Ø¯Ø§Ø¯ÛŒ', 'Ù†Ø§Ù†Ø§', 'Ù†Ø§Ù†ÛŒ', 'Ù¾ÙˆØªØ§', 'Ù¾ÙˆØªÛŒ', 'Ù†ÙˆØ§Ø³Û', 'Ù†ÙˆØ§Ø³ÛŒ', 'Ú†Ú†Ø§', 'Ú†Ú†ÛŒ', 'Ù…Ø§Ù…ÙˆÚº', 'Ù…Ù…Ø§Ù†ÛŒ', 'Ø®Ø§Ù„Û', 'Ø®Ø§Ù„Ùˆ', 'Ù¾Ú¾ÙˆÙ¾Ú¾Ø§', 'Ù¾Ú¾ÙˆÙ¾Ú¾ÛŒ',
            'Ø§Ø³ØªØ§Ø¯', 'Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù…', 'ÚˆØ§Ú©Ù¹Ø±', 'Ù…Ø±ÛŒØ¶', 'Ø§Ù†Ø¬ÛŒÙ†Ø¦Ø±', 'ÙˆÚ©ÛŒÙ„', 'Ø¬Ø¬', 'Ú©Ø³Ø§Ù†', 'Ø¯Ú©Ø§Ù†Ø¯Ø§Ø±', 'Ú¯Ø§ÛÚ©', 'Ø¨Ø§ÙˆØ±Ú†ÛŒ', 'ÚˆØ±Ø§Ø¦ÛŒÙˆØ±', 'Ù¾Ø§Ø¦Ù„Ù¹', 'ÙÙˆØ¬ÛŒ', 'Ù¾ÙˆÙ„ÛŒØ³', 'Ù…ØµÙˆØ±', 'Ú¯Ù„ÙˆÚ©Ø§Ø±', 'Ø§Ø¯Ø§Ú©Ø§Ø±', 'Ú©Ú¾Ù„Ø§Ú‘ÛŒ', 'Ø³Ø§Ø¦Ù†Ø³Ø¯Ø§Ù†', 'Ù…Ø²Ø¯ÙˆØ±', 'Ù…Ù„Ø§Ø²Ù…', 'Ø§ÙØ³Ø±', 'Ø­Ú©Ù…Ø±Ø§Ù†', 'ÙˆØ²ÛŒØ±', 'ØµØ¯Ø±', 'Ø¨Ø§Ø¯Ø´Ø§Û', 'Ù…Ù„Ú©Û', 'Ø´ÛØ²Ø§Ø¯Û', 'Ø´ÛØ²Ø§Ø¯ÛŒ',
            'ØµÙØ±', 'Ø§ÛŒÚ©', 'Ø¯Ùˆ', 'ØªÛŒÙ†', 'Ú†Ø§Ø±', 'Ù¾Ø§Ù†Ú†', 'Ú†Ú¾', 'Ø³Ø§Øª', 'Ø¢Ù¹Ú¾', 'Ù†Ùˆ', 'Ø¯Ø³', 'Ú¯ÛŒØ§Ø±Û', 'Ø¨Ø§Ø±Û', 'ØªÛŒØ±Û', 'Ú†ÙˆØ¯Û', 'Ù¾Ù†Ø¯Ø±Û', 'Ø³ÙˆÙ„Û', 'Ø³ØªØ±Û', 'Ø§Ù¹Ú¾Ø§Ø±Û', 'Ø§Ù†ÛŒØ³', 'Ø¨ÛŒØ³', 'Ø§Ú©ÛŒØ³', 'ØªÛŒØ³', 'Ú†Ø§Ù„ÛŒØ³', 'Ù¾Ú†Ø§Ø³', 'Ø³Ø§Ù¹Ú¾', 'Ø³ØªØ±', 'Ø§Ø³ÛŒ', 'Ù†ÙˆÛ’', 'Ø³Ùˆ', 'Ø¯Ùˆ Ø³Ùˆ', 'ÛØ²Ø§Ø±', 'Ø¯Ø³ ÛØ²Ø§Ø±', 'Ù„Ø§Ú©Ú¾', 'Ú©Ø±ÙˆÚ‘', 'Ù¾ÛÙ„Ø§', 'Ø¯ÙˆØ³Ø±Ø§', 'ØªÛŒØ³Ø±Ø§', 'Ø¢Ø®Ø±ÛŒ', 'Ø¢Ø¯Ú¾Ø§', 'Ù¾ÙˆØ±Ø§',
            'Ú¯Ú¾Ø±', 'Ù…Ú©Ø§Ù†', 'Ú©Ù…Ø±Û', 'Ø¨Ø§ÙˆØ±Ú†ÛŒ Ø®Ø§Ù†Û', 'ØºØ³Ù„ Ø®Ø§Ù†Û', 'Ø¯ÛŒÙˆØ§Ù† Ø®Ø§Ù†Û', 'Ú†Ú¾Øª', 'ØµØ­Ù†', 'Ø§Ø³Ú©ÙˆÙ„', 'Ú©Ø§Ù„Ø¬', 'ÛŒÙˆÙ†ÛŒÙˆØ±Ø³Ù¹ÛŒ', 'Ú©ØªØ¨ Ø®Ø§Ù†Û', 'Ø¯ÙØªØ±', 'Ø¨Ø§Ø²Ø§Ø±', 'Ø¯Ú©Ø§Ù†', 'ÛØ³Ù¾ØªØ§Ù„', 'Ú©Ù„ÛŒÙ†Ú©', 'Ø¨Ø§Øº', 'Ù¾Ø§Ø±Ú©', 'Ú©Ú¾ÛŒÙ„ Ú©Ø§ Ù…ÛŒØ¯Ø§Ù†', 'Ø´ÛØ±', 'Ú¯Ø§Ø¤Úº', 'Ù‚ØµØ¨Û', 'Ù…Ù„Ú©', 'ØµÙˆØ¨Û', 'Ø¯Ø§Ø±Ø§Ù„Ø­Ú©ÙˆÙ…Øª', 'Ø¯Ù†ÛŒØ§', 'Ù…Ø³Ø¬Ø¯', 'Ù…Ù†Ø¯Ø±', 'Ú¯Ø±Ø¬Ø§', 'Ø³Ú‘Ú©', 'Ú¯Ù„ÛŒ', 'Ú†ÙˆÚ©', 'ÛÙˆÙ¹Ù„', 'Ø±ÛŒØ³Ù¹ÙˆØ±Ù†Ù¹', 'Ø¨ÛŒÙ†Ú©', 'Ø§Ø¦ÛŒØ±Ù¾ÙˆØ±Ù¹', 'Ø§Ø³Ù¹ÛŒØ´Ù†', 'Ø¨Ø³ Ø§Ø³Ù¹Ø§Ù¾', 'Ø¹Ø¬Ø§Ø¦Ø¨ Ú¯Ú¾Ø±', 'Ú†Ú‘ÛŒØ§ Ú¯Ú¾Ø±', 'ÙÛŒÚ©Ù¹Ø±ÛŒ', 'Ú©Ø§Ø±Ø®Ø§Ù†Û', 'Ú©Ú¾ÛŒØª',
            'Ù¾Ø§Ù†ÛŒ', 'Ú©Ú¾Ø§Ù†Ø§', 'Ú†Ø§Ø¦Û’', 'Ú©Ø§ÙÛŒ', 'Ø¯ÙˆØ¯Ú¾', 'Ø¯ÛÛŒ', 'Ù„Ø³ÛŒ', 'Ø¬ÙˆØ³', 'Ø´Ø±Ø¨Øª', 'Ø±ÙˆÙ¹ÛŒ', 'Ú†Ø§ÙˆÙ„', 'Ø³Ø§Ù„Ù†', 'Ø³Ø¨Ø²ÛŒ', 'Ù¾Ú¾Ù„', 'Ø³ÛŒØ¨', 'Ú©ÛŒÙ„Ø§', 'Ø¢Ù…', 'Ø³Ù†ØªØ±Ø§', 'Ø§Ù…Ø±ÙˆØ¯', 'ØªØ±Ø¨ÙˆØ²', 'Ø§Ù†Ú¯ÙˆØ±', 'Ú¯ÙˆØ´Øª', 'Ù…Ø±ØºÛŒ', 'Ù…Ú†Ú¾Ù„ÛŒ', 'Ø§Ù†ÚˆØ§', 'Ú†ÛŒÙ†ÛŒ', 'Ù†Ù…Ú©', 'Ù…Ø±Ú†', 'ÛÙ„Ø¯ÛŒ', 'Ù…Ø³Ø§Ù„Ø§', 'Ú¯Ú¾ÛŒ', 'ØªÛŒÙ„', 'Ù…Ú©Ú¾Ù†', 'Ù¾Ù†ÛŒØ±', 'Ù†Ø§Ø´ØªÛ', 'Ø¯ÙˆÙ¾ÛØ± Ú©Ø§ Ú©Ú¾Ø§Ù†Ø§', 'Ø±Ø§Øª Ú©Ø§ Ú©Ú¾Ø§Ù†Ø§', 'Ø¢Ù¹Ø§', 'Ø¯Ø§Ù„', 'Ù¾ÛŒØ§Ø²', 'Ù¹Ù…Ø§Ù¹Ø±', 'Ø¢Ù„Ùˆ', 'Ù„ÛØ³Ù†', 'Ø§Ø¯Ø±Ú©', 'Ù…Ù¹Ú¾Ø§Ø¦ÛŒ', 'Ú©ÛŒÚ©', 'Ø¨Ø³Ú©Ù¹',
            'Ú©ØªØ§Ø¨', 'Ù‚Ù„Ù…', 'Ù¾Ù†Ø³Ù„', 'Ú©Ø§Ù¾ÛŒ', 'Ú©Ø§ØºØ°', 'Ø®Ø·', 'Ù„ÙØ§ÙÛ', 'Ù…ÛŒØ²', 'Ú©Ø±Ø³ÛŒ', 'Ø¯Ø±ÙˆØ§Ø²Û', 'Ú©Ú¾Ú‘Ú©ÛŒ', 'Ú¯Ø§Ú‘ÛŒ', 'Ø¨Ø³', 'Ø³Ø§Ø¦ÛŒÚ©Ù„', 'Ù…ÙˆÙ¹Ø± Ø³Ø§Ø¦ÛŒÚ©Ù„', 'Ø¬ÛØ§Ø²', 'Ù¹Ø±ÛŒÙ†', 'Ú©Ø´ØªÛŒ', 'Ù¾ÛŒØ³Û’', 'Ø³Ú©Û', 'Ù†ÙˆÙ¹', 'Ø±Ù†Ú¯', 'ØªØµÙˆÛŒØ±', 'ÙÙˆÙ†', 'Ù…ÙˆØ¨Ø§Ø¦Ù„', 'Ú©Ù…Ù¾ÛŒÙˆÙ¹Ø±', 'Ù„ÛŒÙ¾ Ù¹Ø§Ù¾', 'Ù¹ÛŒ ÙˆÛŒ', 'Ø±ÛŒÚˆÛŒÙˆ', 'Ú¯Ú¾Ú‘ÛŒ', 'Ú†Ø§Ø¨ÛŒ', 'ØªØ§Ù„Ø§', 'Ø¨Ø³ØªØ±', 'ØªÚ©ÛŒÛ', 'Ú©Ù…Ø¨Ù„', 'Ú†Ø§Ø¯Ø±', 'Ú©Ù¾Ú‘Û’', 'Ù‚Ù…ÛŒØ¶', 'Ù¾ØªÙ„ÙˆÙ†', 'Ø´Ù„ÙˆØ§Ø±', 'Ø¬ÙˆØªØ§', 'Ú†Ù¾Ù„', 'Ù…ÙˆØ²Û’', 'Ù¹ÙˆÙ¾ÛŒ', 'Ø¨ÛŒÚ¯', 'Ø¨Ø³ØªÛ', 'ØµØ§Ø¨Ù†', 'Ø´ÛŒÙ…Ù¾Ùˆ', 'ØªÙˆÙ„ÛŒÛ', 'Ø´ÛŒØ´Û', 'Ø¢Ø¦ÛŒÙ†Û', 'Ú©Ù†Ú¯Ú¾ÛŒ', 'Ø§Ø®Ø¨Ø§Ø±', 'Ø±Ø³Ø§Ù„Û', 'Ú©ÛØ§Ù†ÛŒ', 'Ù†Ø¸Ù…', 'ØªØ­ÙÛ', 'Ø§ÙˆØ²Ø§Ø±', 'ÛØªÚ¾ÛŒØ§Ø±', 'Ø¨Ù†Ø¯ÙˆÙ‚', 'ØªÙ„ÙˆØ§Ø±', 'Ú†Ú¾Ø±ÛŒ', 'Ú†Ù…Ú†', 'Ú©Ø§Ù†Ù¹Ø§', 'Ù¾Ù„ÛŒÙ¹', 'Ú¯Ù„Ø§Ø³', 'Ù¾ÛŒØ§Ù„ÛŒ', 'Ø¯ÛŒÚ¯Ú†ÛŒ',
            'ÙˆÙ‚Øª', 'Ø¯Ù†', 'Ø±Ø§Øª', 'Ø¢Ø¬', 'Ú©Ù„', 'Ù¾Ø±Ø³ÙˆÚº', 'ØµØ¨Ø­', 'Ø¯ÙˆÙ¾ÛØ±', 'Ø³Û Ù¾ÛØ±', 'Ø´Ø§Ù…', 'Ø¢Ø¯Ú¾ÛŒ Ø±Ø§Øª', 'Ù…Ù†Ù¹', 'Ø³ÛŒÚ©Ù†Úˆ', 'Ú¯Ú¾Ù†Ù¹Û', 'ÛÙØªÛ', 'Ù…ÛÛŒÙ†Û', 'Ø³Ø§Ù„', 'ØµØ¯ÛŒ', 'ØªØ§Ø±ÛŒØ®', 'Ø§ØªÙˆØ§Ø±', 'Ù¾ÛŒØ±', 'Ù…Ù†Ú¯Ù„', 'Ø¨Ø¯Ú¾', 'Ø¬Ù…Ø¹Ø±Ø§Øª', 'Ø¬Ù…Ø¹Û', 'ÛÙØªÛ', 'Ø¬Ù†ÙˆØ±ÛŒ', 'ÙØ±ÙˆØ±ÛŒ', 'Ù…Ø§Ø±Ú†', 'Ø§Ù¾Ø±ÛŒÙ„', 'Ù…Ø¦ÛŒ', 'Ø¬ÙˆÙ†', 'Ø¬ÙˆÙ„Ø§Ø¦ÛŒ', 'Ø§Ú¯Ø³Øª', 'Ø³ØªÙ…Ø¨Ø±', 'Ø§Ú©ØªÙˆØ¨Ø±', 'Ù†ÙˆÙ…Ø¨Ø±', 'Ø¯Ø³Ù…Ø¨Ø±',
            'Ù†Ø§Ù…', 'Ú©Ø§Ù…', 'Ø¨Ø§Øª', 'Ø²Ø¨Ø§Ù†', 'Ø§Ø±Ø¯Ùˆ', 'Ø§Ù†Ú¯Ø±ÛŒØ²ÛŒ', 'Ù…Ø·Ù„Ø¨', 'Ù…Ø¹Ù†ÛŒ', 'Ø³ÙˆØ§Ù„', 'Ø¬ÙˆØ§Ø¨', 'Ù…Ø¯Ø¯', 'Ø¶Ø±ÙˆØ±Øª', 'Ø®ÙˆØ§ÛØ´', 'Ù¾ÛŒØ§Ø±', 'Ù…Ø­Ø¨Øª', 'Ø¹Ø´Ù‚', 'Ù†ÙØ±Øª', 'Ø®ÙˆØ´ÛŒ', 'ØºÙ…', 'ØºØµÛ', 'ÚˆØ±', 'Ø®ÙˆÙ', 'Ø§Ù…ÛŒØ¯', 'ÛŒÙ‚ÛŒÙ†', 'Ø´Ú©', 'Ø²Ù†Ø¯Ú¯ÛŒ', 'Ù…ÙˆØª', 'Ø´Ø§Ø¯ÛŒ', 'Ø·Ù„Ø§Ù‚', 'Ø¬Ø´Ù†', 'Ù…ÙˆØ³Ù…', 'Ú¯Ø±Ù…ÛŒ', 'Ø³Ø±Ø¯ÛŒ', 'Ø¨ÛØ§Ø±', 'Ø®Ø²Ø§Úº', 'Ø¨Ø§Ø±Ø´', 'Ø¨Ø±Ù', 'Ø·ÙˆÙØ§Ù†', 'ÛÙˆØ§', 'Ø¢Ú¯', 'Ø¢ÙˆØ§Ø²', 'Ø´ÙˆØ±', 'Ø®Ø§Ù…ÙˆØ´ÛŒ', 'Ø±ÙˆØ´Ù†ÛŒ', 'Ø§Ù†Ø¯Ú¾ÛŒØ±Ø§', 'Ø³Ú†', 'Ø¬Ú¾ÙˆÙ¹', 'Ø®ÙˆØ§Ø¨', 'Ø­Ù‚ÛŒÙ‚Øª', 'Ø¹Ù„Ù…', 'Ø¬ÛØ§Ù„Øª', 'Ø§Ù†ØµØ§Ù', 'Ø¸Ù„Ù…', 'Ø¢Ø²Ø§Ø¯ÛŒ', 'ØºÙ„Ø§Ù…ÛŒ', 'ØµØ­Øª', 'Ø¨ÛŒÙ…Ø§Ø±ÛŒ', 'Ú©Ø§Ù…ÛŒØ§Ø¨ÛŒ', 'Ù†Ø§Ú©Ø§Ù…ÛŒ', 'Ø§Ù…Ù†', 'Ø¬Ù†Ú¯', 'Ù…Ø°ÛØ¨', 'Ø§Ø³Ù„Ø§Ù…', 'Ù‚Ø§Ù†ÙˆÙ†', 'Ø³ÛŒØ§Ø³Øª', 'ØªØ§Ø±ÛŒØ®', 'Ø¬ØºØ±Ø§ÙÛŒÛ', 'Ø³Ø§Ø¦Ù†Ø³', 'ÙÙ†', 'Ù…ÙˆØ³ÛŒÙ‚ÛŒ', 'Ú©Ú¾ÛŒÙ„', 'Ù‚Ø³Ù…Øª', 'Ù…ÙˆÙ‚Ø¹', 'ØºÙ„Ø·ÛŒ', 'Ø®ÛŒØ§Ù„', 'Ø³ÙˆÚ†', 'ÙˆØ¬Û', 'Ù†ØªÛŒØ¬Û', 'ÙØ±Ù‚', 'Ø´Ú©Ù„', 'Ø³Ø§Ø¦Ø²',
            'Ø§Ú†Ú¾Ø§', 'Ø¨Ø±Ø§', 'Ø¨Ú‘Ø§', 'Ú†Ú¾ÙˆÙ¹Ø§', 'Ù†ÛŒØ§', 'Ù¾Ø±Ø§Ù†Ø§', 'Ø®ÙˆØ¨ØµÙˆØ±Øª', 'Ø¨Ø¯ØµÙˆØ±Øª', 'Ù„Ù…Ø¨Ø§', 'Ù¾Ø³Øª Ù‚Ø¯', 'Ù…ÙˆÙ¹Ø§', 'Ù¾ØªÙ„Ø§', 'Ø¯Ø¨Ù„Ø§', 'Ú¯Ø±Ù…', 'Ù¹Ú¾Ù†ÚˆØ§', 'Ø®ÙˆØ´', 'Ø§Ø¯Ø§Ø³', 'Ù†Ø§Ø±Ø§Ø¶', 'Ø¨ÛŒÙ…Ø§Ø±', 'ØµØ­Øª Ù…Ù†Ø¯', 'Ø§Ù…ÛŒØ±', 'ØºØ±ÛŒØ¨', 'Ø¢Ø³Ø§Ù†', 'Ù…Ø´Ú©Ù„', 'Ú©Ù¹Ú¾Ù†', 'ØµØ­ÛŒØ­', 'ØºÙ„Ø·', 'ØµØ§Ù', 'Ú¯Ù†Ø¯Ø§', 'Ø®Ø§Ù„ÛŒ', 'Ø¨Ú¾Ø±Ø§', 'ØªÛŒØ²', 'Ø¢ÛØ³ØªÛ', 'Ù…Ø¶Ø¨ÙˆØ·', 'Ú©Ù…Ø²ÙˆØ±', 'Ø³Ø³ØªØ§', 'Ù…ÛÙ†Ú¯Ø§', 'Ù…ÛŒÙ¹Ú¾Ø§', 'Ú©Ú‘ÙˆØ§', 'Ù†Ù…Ú©ÛŒÙ†', 'Ù¾Ú¾ÛŒÚ©Ø§', 'ØªÛŒØ§Ø±', 'Ù…ØµØ±ÙˆÙ', 'ÙØ§Ø±Øº', 'Ø²Ù†Ø¯Û', 'Ù…Ø±Ø¯Û', 'Ø§Ú©ÛŒÙ„Ø§', 'Ø´Ø§Ø¯ÛŒ Ø´Ø¯Û', 'Ú©Ù†ÙˆØ§Ø±Û', 'Ø°ÛÛŒÙ†', 'Ø¨ÛŒÙˆÙ‚ÙˆÙ', 'Ø¨ÛØ§Ø¯Ø±', 'Ø¨Ø²Ø¯Ù„', 'Ø§ÛŒÙ…Ø§Ù†Ø¯Ø§Ø±', 'Ø¨Û’ Ø§ÛŒÙ…Ø§Ù†', 'Ù…Ø­Ù†ØªÛŒ', 'Ø³Ø³Øª', 'Ú©Ø§ÛÙ„', 'Ø¯Ù„Ú†Ø³Ù¾', 'Ø¨ÙˆØ±Ù†Ú¯', 'Ø¶Ø±ÙˆØ±ÛŒ', 'ØºÛŒØ± Ø¶Ø±ÙˆØ±ÛŒ', 'Ø®Ø§Øµ', 'Ø¹Ø§Ù…', 'Ù…Ø´ÛÙˆØ±', 'Ú¯Ù…Ù†Ø§Ù…', 'ØªØ§Ø²Û', 'Ø¨Ø§Ø³ÛŒ', 'Ú¯ÛØ±Ø§', 'ÛÙ„Ú©Ø§', 'Ú¯ÛŒÙ„Ø§', 'Ø®Ø´Ú©', 'Ø³Ø®Øª', 'Ù†Ø±Ù…', 'Ø³ÛŒØ¯Ú¾Ø§', 'Ù¹ÛŒÚ‘Ú¾Ø§', 'Ú¯ÙˆÙ„', 'Ú†ÙˆÚ©ÙˆØ±', 'Ù¾Ø§Ú¯Ù„', 'Ø¹Ù‚Ù„Ù…Ù†Ø¯',
            'Ø¬Ø³Ù…', 'Ø³Ø±', 'Ø¨Ø§Ù„', 'Ú†ÛØ±Û', 'Ø¢Ù†Ú©Ú¾', 'Ù†Ø§Ú©', 'Ù…Ù†Û', 'Ø²Ø¨Ø§Ù†', 'Ø¯Ø§Ù†Øª', 'ÛÙˆÙ†Ù¹', 'Ú©Ø§Ù†', 'Ú¯Ø±Ø¯Ù†', 'Ú©Ù†Ø¯Ú¾Ø§', 'ÛØ§ØªÚ¾', 'Ø¨Ø§Ø²Ùˆ', 'Ø§Ù†Ú¯Ù„ÛŒ', 'Ù†Ø§Ø®Ù†', 'Ø³ÛŒÙ†Û', 'Ù¾ÛŒÙ¹', 'Ú©Ù…Ø±', 'Ù¾Ø§Ø¤Úº', 'Ù¹Ø§Ù†Ú¯', 'Ú¯Ú¾Ù¹Ù†Ø§', 'Ø¯Ù„', 'Ø¯Ù…Ø§Øº', 'Ø®ÙˆÙ†', 'ÛÚˆÛŒ', 'Ø¬Ù„Ø¯',
            'Ø¢Ø³Ù…Ø§Ù†', 'Ø³ÙˆØ±Ø¬', 'Ú†Ø§Ù†Ø¯', 'Ø³ØªØ§Ø±Û', 'Ø²Ù…ÛŒÙ†', 'Ø¯Ø±ÛŒØ§', 'Ù†Ø¯ÛŒ', 'Ø³Ù…Ù†Ø¯Ø±', 'Ø¬Ú¾ÛŒÙ„', 'Ù¾ÛØ§Ú‘', 'Ú†Ù¹Ø§Ù†', 'Ø¬Ù†Ú¯Ù„', 'ØµØ­Ø±Ø§', 'Ù…ÛŒØ¯Ø§Ù†', 'Ø¬Ø§Ù†ÙˆØ±', 'Ù¾Ø±Ù†Ø¯Û', 'ÑˆÛŒØ±', 'Ú†ÛŒØªØ§', 'ÛØ§ØªÚ¾ÛŒ', 'Ú¯Ú¾ÙˆÚ‘Ø§', 'Ú©ØªØ§', 'Ø¨Ù„ÛŒ', 'Ú¯Ø§Ø¦Û’', 'Ø¨Ú¾ÛŒÙ†Ø³', 'Ø¨Ú©Ø±ÛŒ', 'Ø³Ø§Ù†Ù¾', 'Ù…ÙˆØ±', 'Ø·ÙˆØ·Ø§', 'Ú©Ø¨ÙˆØªØ±', 'Ù¾Ú¾ÙˆÙ„', 'Ú¯Ù„Ø§Ø¨', 'Ø¯Ø±Ø®Øª', 'Ù¾ÙˆØ¯Ø§', 'Ù¾ØªØ§', 'Ú¯Ú¾Ø§Ø³',
            'Ø³Ø±Ø®', 'Ù„Ø§Ù„', 'Ù†ÛŒÙ„Ø§', 'Ù¾ÛŒÙ„Ø§', 'Ø³Ø¨Ø²', 'Ú©Ø§Ù„Ø§', 'Ø³ÙÛŒØ¯', 'Ú¯Ù„Ø§Ø¨ÛŒ', 'Ù†Ø§Ø±Ù†Ø¬ÛŒ', 'Ø¬Ø§Ù…Ù†ÛŒ', 'Ø¨Ú¾ÙˆØ±Ø§', 'Ø³Ø±Ù…Ø¦ÛŒ', 'Ø³Ù†ÛØ±Ø§', 'Ú†Ø§Ù†Ø¯ÛŒ',
            'ÛÙˆÙ†Ø§', 'Ú©Ø±Ù†Ø§', 'Ø¬Ø§Ù†Ø§', 'Ø¢Ù†Ø§', 'Ø¯ÛŒÚ©Ú¾Ù†Ø§', 'Ø¨ÙˆÙ„Ù†Ø§', 'Ú©ÛÙ†Ø§', 'Ø³Ù†Ù†Ø§', 'Ù¾Ú‘Ú¾Ù†Ø§', 'Ù„Ú©Ú¾Ù†Ø§', 'Ø³ÙˆÙ†Ø§', 'Ø¬Ø§Ú¯Ù†Ø§', 'Ø§Ù¹Ú¾Ù†Ø§', 'Ø¨ÛŒÙ¹Ú¾Ù†Ø§', 'Ú©Ú¾Ú‘Ø§ ÛÙˆÙ†Ø§', 'Ú†Ù„Ù†Ø§', 'Ø¯ÙˆÚ‘Ù†Ø§', 'Ø§Ú‘Ù†Ø§', 'ØªÛŒØ±Ù†Ø§', 'Ù¾ÛŒÙ†Ø§', 'Ú©Ú¾Ø§Ù†Ø§', 'Ù¾Ú©Ø§Ù†Ø§', 'Ø±Ú©Ú¾Ù†Ø§', 'Ø§Ù¹Ú¾Ø§Ù†Ø§', 'Ø¯ÛŒÙ†Ø§', 'Ù„ÛŒÙ†Ø§', 'Ú†Ø§ÛÙ†Ø§', 'Ù¾Ø³Ù†Ø¯ Ú©Ø±Ù†Ø§', 'Ù†ÙØ±Øª Ú©Ø±Ù†Ø§', 'Ø³Ù…Ø¬Ú¾Ù†Ø§', 'Ø³Ù…Ø¬Ú¾Ø§Ù†Ø§', 'Ù¾ÙˆÚ†Ú¾Ù†Ø§', 'Ø¨ØªØ§Ù†Ø§', 'Ú©Ø§Ù… Ú©Ø±Ù†Ø§', 'Ú©Ú¾ÛŒÙ„Ù†Ø§', 'Ù„Ú‘Ù†Ø§', 'ÛÙ†Ø³Ù†Ø§', 'Ø±ÙˆÙ†Ø§', 'Ù…Ø³Ú©Ø±Ø§Ù†Ø§', 'Ù…Ù„Ù†Ø§', 'Ù…Ù„Ø§Ù†Ø§', 'Ø®Ø±ÛŒØ¯Ù†Ø§', 'Ø¨ÛŒÚ†Ù†Ø§', 'Ù¾ÛÙ†Ù†Ø§', 'Ø§ØªØ§Ø±Ù†Ø§', 'Ú©Ú¾ÙˆÙ„Ù†Ø§', 'Ø¨Ù†Ø¯ Ú©Ø±Ù†Ø§', 'Ø´Ø±ÙˆØ¹ Ú©Ø±Ù†Ø§', 'Ø®ØªÙ… Ú©Ø±Ù†Ø§', 'Ø§Ù†ØªØ¸Ø§Ø± Ú©Ø±Ù†Ø§', 'ÛŒØ§Ø¯ Ú©Ø±Ù†Ø§', 'Ø¨Ú¾ÙˆÙ„Ù†Ø§', 'Ø³Ú©Ú¾Ø§Ù†Ø§', 'Ø³ÛŒÚ©Ú¾Ù†Ø§', 'Ø±ÛÙ†Ø§', 'Ù…Ø±Ù†Ø§', 'Ù¾ÛŒØ¯Ø§ ÛÙˆÙ†Ø§', 'Ø¨Ù†Ø§Ù†Ø§', 'Ø¨Ú¯Ø§Ú‘Ù†Ø§', 'Ø³ÙˆÚ†Ù†Ø§', 'Ú©ÙˆØ´Ø´ Ú©Ø±Ù†Ø§', 'Ù…Ø¯Ø¯ Ú©Ø±Ù†Ø§', 'Ø¯Ú¾ÙˆÙ†Ø§', 'ØµØ§Ù Ú©Ø±Ù†Ø§', 'Ú¯Ø±Ù†Ø§', 'Ù¾Ú©Ú‘Ù†Ø§', 'Ú†Ú¾ÙˆÚ‘Ù†Ø§', 'ÚˆÚ¾ÙˆÙ†ÚˆÙ†Ø§', 'Ú©Ú¾ÙˆÙ†Ø§', 'Ø¨Ú¾ÛŒØ¬Ù†Ø§', 'ÙˆØµÙˆÙ„ Ú©Ø±Ù†Ø§', 'ØªÙˆÚ‘Ù†Ø§', 'Ø¬ÙˆÚ‘Ù†Ø§', 'Ø¬ÛŒØªÙ†Ø§', 'ÛØ§Ø±Ù†Ø§', 'ÚˆØ±Ù†Ø§', 'ÚˆØ§Ù„Ù†Ø§', 'Ù†Ú©Ø§Ù„Ù†Ø§', 'Ú†Ú‘Ú¾Ù†Ø§', 'Ø§ØªØ±Ù†Ø§', 'Ø¯Ø§Ø®Ù„ ÛÙˆÙ†Ø§', 'Ø¨Ø§ÛØ± Ù†Ú©Ù„Ù†Ø§', 'Ù¾ÛÙ†Ú†Ù†Ø§', 'Ø¨ØªØ§Ù†Ø§', 'Ù¾Ú©Ø§Ø±Ù†Ø§', 'Ú†Ù„Ø§Ù†Ø§',
            'Ø¨ÛØª', 'Ú©Ù…', 'ØªÚ¾ÙˆÚ‘Ø§', 'Ø²ÛŒØ§Ø¯Û', 'ØµØ±Ù', 'Ø¨Ú¾ÛŒ', 'ÛÛŒ', 'ÛŒÛØ§Úº', 'ÙˆÛØ§Úº', 'Ø¬Ø¯Ú¾Ø±', 'Ø§Ø¯Ú¾Ø±', 'Ø§Ø¨', 'Ø§Ø¨Ú¾ÛŒ', 'ØªØ¨', 'Ø¬Ø¨', 'Ú©Ø¨', 'Ù¾Ú¾Ø±', 'Ø¬Ù„Ø¯ÛŒ', 'Ø¢ÛØ³ØªÛ', 'Ø¢Ø±Ø§Ù… Ø³Û’', 'ØªÛŒØ²ÛŒ Ø³Û’', 'Ø²ÙˆØ± Ø³Û’', 'Ø§ÙˆÙ¾Ø±', 'Ù†ÛŒÚ†Û’', 'Ø§Ù†Ø¯Ø±', 'Ø¨Ø§ÛØ±', 'Ø¢Ú¯Û’', 'Ù¾ÛŒÚ†Ú¾Û’', 'Ø³Ø§ØªÚ¾', 'Ø§Ú©ÛŒÙ„Û’', 'Ù¾Ø§Ø³', 'Ù†Ø²Ø¯ÛŒÚ©', 'Ø¯ÙˆØ±', 'Ù¾ÛÙ„Û’', 'Ø¨Ø¹Ø¯ Ù…ÛŒÚº', 'ÛÙ…ÛŒØ´Û', 'Ø§Ú©Ø«Ø±', 'Ú©Ø¨Ú¾ÛŒ Ú©Ø¨Ú¾ÛŒ', 'Ú©Ø¨Ú¾ÛŒ Ù†ÛÛŒÚº', 'Ø´Ø§ÛŒØ¯', 'ÛŒÙ‚ÛŒÙ†Ø§Ù‹', 'Ø¶Ø±ÙˆØ±', 'Ø¨Ù„Ú©Ù„', 'ØªÙ‚Ø±ÛŒØ¨Ø§Ù‹', 'Ø®Ø§Øµ Ø·ÙˆØ± Ù¾Ø±',
            'Ù…ÛŒÚº', 'Ù¾Ø±', 'Ø³Û’', 'ØªÚ©', 'Ú©Ùˆ', 'Ú©Ø§', 'Ú©ÛŒ', 'Ú©Û’', 'Ù„ÛŒÛ’', 'Ú©ÛŒ Ø·Ø±Ù', 'Ú©Û’ Ø¨Ø§Ø±Û’ Ù…ÛŒÚº', 'Ú©Û’ Ø³Ø§ØªÚ¾', 'Ú©Û’ Ø¨ØºÛŒØ±', 'Ú©Û’ Ù†ÛŒÚ†Û’', 'Ú©Û’ Ø§ÙˆÙ¾Ø±', 'Ú©Û’ Ø³Ø§Ù…Ù†Û’', 'Ú©Û’ Ù¾ÛŒÚ†Ú¾Û’', 'Ú©Û’ Ø§Ù†Ø¯Ø±', 'Ú©Û’ Ø¨Ø§ÛØ±',
            'Ø§ÙˆØ±', 'Ù„ÛŒÚ©Ù†', 'Ù…Ú¯Ø±', 'Ù¾Ø±', 'ÛŒØ§', 'ØªÙˆ', 'Ù¾Ú¾Ø±', 'Ú©ÛŒÙˆÙ†Ú©Û', 'Ø§Ø³ Ù„ÛŒÛ’', 'ØªØ§Ú©Û', 'Ø§Ú¯Ø±', 'Ø¬Ø¨Ú©Û', 'Ø­Ø§Ù„Ø§Ù†Ú©Û', 'Ú©Û',
            'ÛØ§Úº', 'Ø¬ÛŒ', 'Ù†ÛÛŒÚº', 'Ø¬ÛŒ Ù†ÛÛŒÚº', 'Ù¹Ú¾ÛŒÚ© ÛÛ’', 'Ø¨ÛØª Ø§Ú†Ú¾Ø§', 'Ø´Ú©Ø±ÛŒÛ', 'Ù…ÛØ±Ø¨Ø§Ù†ÛŒ', 'Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯', 'Ù…Ø¹Ø§Ù Ú©ÛŒØ¬Ø¦Û’', 'Ú©ÙˆØ¦ÛŒ Ø¨Ø§Øª Ù†ÛÛŒÚº', 'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÛŒÚ©Ù…', 'ÙˆØ¹Ù„ÛŒÚ©Ù… Ø§Ù„Ø³Ù„Ø§Ù…', 'Ø®Ø¯Ø§ Ø­Ø§ÙØ¸', 'Ø§Ù„Ù„Û Ø­Ø§ÙØ¸', 'ØµØ¨Ø­ Ø¨Ø®ÛŒØ±', 'Ø´Ø§Ù… Ø¨Ø®ÛŒØ±', 'Ø´Ø¨ Ø¨Ø®ÛŒØ±', 'Ø§Ù„ÙˆØ¯Ø§Ø¹', 'Ù…Ø¨Ø§Ø±Ú© ÛÙˆ', 'Ø§ÙØ³ÙˆØ³', 'Ø´Ø§Ø¨Ø§Ø´', 'Ø§Ø±Û’', 'Ø§ÙˆÛ', 'Ø§Ù',
            'Ù…ÛŒØ±Ø§ Ù†Ø§Ù… Ø¹Ù„ÛŒ ÛÛ’', 'Ø¢Ù¾ Ú©ÛŒØ³Û’ ÛÛŒÚº', 'Ù…ÛŒÚº Ù¹Ú¾ÛŒÚ© ÛÙˆÚº', 'Ø¢Ù¾ Ú©Ø§ Ù†Ø§Ù… Ú©ÛŒØ§ ÛÛ’', 'Ø¢Ù¾ Ú©ÛØ§Úº Ø³Û’ ÛÛŒÚº', 'ÙˆÙ‚Øª Ú©ÛŒØ§ ÛÙˆØ§ ÛÛ’', 'ÛŒÛ Ú©ØªÙ†Û’ Ú©Ø§ ÛÛ’', 'Ù…Ø¬Ú¾Û’ ÛŒÛ Ú†Ø§ÛÛŒÛ’', 'Ù…Ø¬Ú¾Û’ Ù†ÛÛŒÚº Ù…Ø¹Ù„ÙˆÙ…', 'Ú©ÛŒØ§ Ø¢Ù¾ Ù…ÛŒØ±ÛŒ Ù…Ø¯Ø¯ Ú©Ø± Ø³Ú©ØªÛ’ ÛÛŒÚº', 'Ù…Ø¬Ú¾Û’ Ø¨Ú¾ÙˆÚ© Ù„Ú¯ÛŒ ÛÛ’', 'Ù…Ø¬Ú¾Û’ Ù¾ÛŒØ§Ø³ Ù„Ú¯ÛŒ ÛÛ’'
        ];
        const ttsVoices = ['Zephyr', 'Puck', 'Charon', 'Kore', 'Fenrir', 'Leda', 'Orus', 'Aoede', 'Callirrhoe', 'Autonoe', 'Enceladus', 'Iapetus', 'Umbriel', 'Algieba', 'Despina', 'Erinome', 'Algenib', 'Rasalgethi', 'Laomedeia', 'Achernar', 'Alnilam', 'Schedar', 'Gacrux', 'Pulcherrima', 'Achird', 'Zubenelgenubi', 'Vindemiatrix', 'Sadachbia', 'Sadaltager', 'Sulafat'];

        const allDOMElements = {
            apiKeySection: document.getElementById('api-key-section'),
            apiKeyInput: document.getElementById('api-key-input'),
            saveApiKeyBtn: document.getElementById('save-api-key-btn'),
            mainContent: document.getElementById('main-content'),
            navHome: document.getElementById('nav-home'),
            navAlphabet: document.getElementById('nav-alphabet'),
            navHistory: document.getElementById('nav-history'),
            navLearned: document.getElementById('nav-learned'),
            navBasket: document.getElementById('nav-basket'),
            homeScreen: document.getElementById('home-screen'),
            alphabetScreen: document.getElementById('alphabet-screen'),
            historyScreen: document.getElementById('history-screen'),
            learnedWordsScreen: document.getElementById('learned-words-screen'),
            basketScreen: document.getElementById('basket-screen'),
            historyList: document.getElementById('history-list'),
            statsSection: document.getElementById('stats-section'),
            totalWordsEl: document.getElementById('total-words'),
            learnedWordsEl: document.getElementById('learned-words'),
            remainingWordsEl: document.getElementById('remaining-words'),
            newLessonBtn: document.getElementById('new-lesson-btn'),
            resetProgressBtn: document.getElementById('reset-progress-btn'),
            loadingScreen: document.getElementById('loading-screen'),
            lessonScreen: document.getElementById('lesson-screen'),
            selectionPopup: document.getElementById('selection-popup'),
        };

        let apiKey = '';
        let learnedWords = [];
        let learningBasket = [];
        let lessonHistory = [];
        let remainingWords = [...a1UrduWords];
        let audioContext;
        let isLessonActive = false;
        let selectionTimeout;
        let isDragging = false;

        function initialize() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.error("Web Audio API is not supported in this browser");
                showModal("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØªÙŠØ§ØªØŒ Ù‚Ø¯ Ù„Ø§ ØªØ¹Ù…Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ÙŠØ²Ø§Øª.");
            }

            loadState();
            updateProgress();
            setupEventListeners();
        }

        function setupEventListeners() {
            allDOMElements.saveApiKeyBtn.addEventListener('click', handleSaveApiKey);
            allDOMElements.apiKeyInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSaveApiKey(); });
            allDOMElements.newLessonBtn.addEventListener('click', handleNewLesson);
            allDOMElements.resetProgressBtn.addEventListener('click', handleResetProgress);
            allDOMElements.navHome.addEventListener('click', () => showTab('home'));
            allDOMElements.navAlphabet.addEventListener('click', () => showTab('alphabet'));
            allDOMElements.navHistory.addEventListener('click', () => showTab('history'));
            allDOMElements.navLearned.addEventListener('click', () => showTab('learned'));
            allDOMElements.navBasket.addEventListener('click', () => showTab('basket'));
            
            // Hybrid interaction model
            const lessonArea = allDOMElements.lessonScreen;
            lessonArea.addEventListener('mousedown', () => { isDragging = false; });
            lessonArea.addEventListener('mousemove', () => { isDragging = true; });
            lessonArea.addEventListener('mouseup', handleInteractionEnd);
            
            // For mobile
            lessonArea.addEventListener('touchstart', () => { isDragging = false; }, { passive: true });
            lessonArea.addEventListener('touchmove', () => { isDragging = true; }, { passive: true });
            lessonArea.addEventListener('touchend', handleInteractionEnd);
            
            document.addEventListener('click', (e) => {
                if (!allDOMElements.selectionPopup.contains(e.target)) {
                    allDOMElements.selectionPopup.classList.add('hidden');
                }
            });

            // Resume audio context on first user interaction
            document.body.addEventListener('click', resumeAudioContext, { once: true });
            document.body.addEventListener('touchend', resumeAudioContext, { once: true });
        }
        
        function handleInteractionEnd(event) {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();

            // Case 1: It was a drag-selection of a phrase
            if (isDragging && selectedText.length > 0) {
                event.preventDefault(); // Prevent click event from firing after drag
                showSelectionPopup(selection);
            }
            // Case 2: It was a simple click/tap on a single word
            else if (!isDragging && event.target.closest('.word-span, b')) {
                const target = event.target.closest('.word-span, b');
                const text = target.textContent.trim().replace(/[.,!?;:]/g, '');
                if (text) {
                    showWordActionModal(text);
                }
            }
            isDragging = false;
        }

        function showSelectionPopup(selection) {
            const selectedText = selection.toString().trim();
            if (!selectedText) return;

            const range = selection.getRangeAt(0);
            const rect = range.getBoundingClientRect();
            const popup = allDOMElements.selectionPopup;
            
            popup.style.left = `${rect.left + window.scrollX + (rect.width / 2) - (popup.offsetWidth / 2)}px`;
            popup.style.top = `${rect.top + window.scrollY - popup.offsetHeight - 10}px`;
            popup.classList.remove('hidden');

            const mood = document.getElementById('story-container')?.dataset.mood || 'neutral';

            popup.querySelector('#popup-translate').onclick = () => { getTranslation(selectedText).then(res => res && showModal(`<p class="text-xl font-bold text-sky-600">${res}</p>`, `ØªØ±Ø¬Ù…Ø©: <span class="font-urdu text-xl">${selectedText}</span>`)); popup.classList.add('hidden'); };
            popup.querySelector('#popup-speak').onclick = () => { speakText(selectedText, mood); }; // Don't hide popup
            popup.querySelector('#popup-phonetics').onclick = () => { getPhonetics(selectedText).then(res => res && showModal(`<p class="text-xl font-bold text-sky-600">${res}</p>`, `Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„Ù€: <span class="font-urdu text-xl">${selectedText}</span>`)); popup.classList.add('hidden'); };
            popup.querySelector('#popup-save').onclick = () => { saveToBasket(selectedText); popup.classList.add('hidden'); };
        }


        function resumeAudioContext() {
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }

        async function showWordActionModal(text) {
            const mood = document.getElementById('story-container')?.dataset.mood || 'neutral';
            
            const modalTitle = `<span class="font-urdu text-3xl">${text}</span>`;
            const modalContent = `<p class="text-slate-600">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯Ù‡ Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø©.</p>`;

            const actions = [
                {
                    text: 'ğŸ‡µğŸ‡° ØªØ±Ø¬Ù…Ø©',
                    class: 'action-translate-btn bg-blue-500 text-white',
                    callback: async () => {
                        const translation = await getTranslation(text);
                        if (translation) {
                           showModal(`<p class="text-xl font-bold text-sky-600">${translation}</p>`, `ØªØ±Ø¬Ù…Ø©: <span class="font-urdu text-xl">${text}</span>`);
                        }
                    }
                },
                {
                    text: 'ğŸ”Š Ù†Ø·Ù‚',
                    class: 'action-speak-btn bg-green-500 text-white',
                    callback: () => speakText(text, mood),
                    keepOpen: true
                },
                {
                    text: 'ğŸ—£ï¸ ÙƒØªØ§Ø¨Ø© ØµÙˆØªÙŠØ©',
                    class: 'action-phonetics-btn bg-purple-500 text-white',
                    callback: async () => {
                        const phonetics = await getPhonetics(text);
                        if (phonetics) {
                            showModal(`<p class="text-xl font-bold text-sky-600">${phonetics}</p>`, `Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„Ù€: <span class="font-urdu text-xl">${text}</span>`);
                        }
                    }
                },
                {
                    text: 'ğŸ’¾ Ø­ÙØ¸ Ù„Ù„Ø³Ù„Ø©',
                    class: 'action-save-btn bg-amber-500 text-white',
                    callback: () => saveToBasket(text)
                }
            ];

            showModal(modalContent, modalTitle, actions);
        }

        function loadState() {
            apiKey = localStorage.getItem('geminiApiKey_ur') || '';
            learnedWords = JSON.parse(localStorage.getItem('learnedWords_ur')) || [];
            learningBasket = JSON.parse(localStorage.getItem('learningBasket_ur')) || [];
            lessonHistory = JSON.parse(localStorage.getItem('lessonHistory_ur')) || [];

            if (apiKey) {
                allDOMElements.apiKeyInput.value = apiKey;
                allDOMElements.apiKeySection.classList.add('hidden');
                allDOMElements.mainContent.classList.remove('hidden');
            }
        }

        function saveState() {
            localStorage.setItem('learnedWords_ur', JSON.stringify(learnedWords));
            localStorage.setItem('learningBasket_ur', JSON.stringify(learningBasket));
            localStorage.setItem('lessonHistory_ur', JSON.stringify(lessonHistory));
        }

        function updateProgress() {
            remainingWords = a1UrduWords.filter(word => !learnedWords.includes(word));
            allDOMElements.totalWordsEl.textContent = a1UrduWords.length;
            allDOMElements.learnedWordsEl.textContent = learnedWords.length;
            allDOMElements.remainingWordsEl.textContent = remainingWords.length;
        }

        function showScreen(screen) {
            const screens = [
                allDOMElements.homeScreen, allDOMElements.alphabetScreen, allDOMElements.historyScreen,
                allDOMElements.learnedWordsScreen, allDOMElements.basketScreen, allDOMElements.loadingScreen,
                allDOMElements.lessonScreen
            ];
            screens.forEach(s => s.classList.add('hidden'));
            if (screen) screen.classList.remove('hidden');
        }

        function showTab(tabName) {
            showScreen(null);
            const navs = [allDOMElements.navHome, allDOMElements.navAlphabet, allDOMElements.navHistory, allDOMElements.navLearned, allDOMElements.navBasket];
            navs.forEach(nav => {
                nav.classList.remove('border-sky-600', 'text-sky-600');
                nav.classList.add('border-transparent', 'text-slate-500');
            });

            const activeNav = document.getElementById(`nav-${tabName}`);
            if (activeNav) {
                activeNav.classList.remove('border-transparent', 'text-slate-500');
                activeNav.classList.add('border-sky-600', 'text-sky-600');
            }

            if (tabName === 'home') {
                showScreen(isLessonActive ? allDOMElements.lessonScreen : allDOMElements.homeScreen);
            } else if (tabName === 'alphabet') {
                renderAlphabetScreen();
                showScreen(allDOMElements.alphabetScreen);
            } else if (tabName === 'history') {
                renderHistory();
                showScreen(allDOMElements.historyScreen);
            } else if (tabName === 'learned') {
                renderLearnedWords();
                showScreen(allDOMElements.learnedWordsScreen);
            } else if (tabName === 'basket') {
                renderBasket();
                showScreen(allDOMElements.basketScreen);
            }
        }

        function showModal(content, title = 'ØªÙ†Ø¨ÙŠÙ‡', actions = []) {
            const existingModal = document.querySelector('.modal-overlay');
            if (existingModal) existingModal.remove();
            
            const actionsHtml = actions.map(action => 
                `<button class="${action.class} px-4 py-2 rounded-md transition">${action.text}</button>`
            ).join('');

            const modalOverlay = document.createElement('div');
            modalOverlay.className = 'modal-overlay';
            modalOverlay.innerHTML = `
                <div class="modal-content">
                    <h3 class="text-xl font-bold mb-4">${title}</h3>
                    <div>${content}</div>
                    <div class="mt-6 flex gap-3 justify-center flex-wrap">
                        ${actionsHtml}
                        <button class="modal-close bg-slate-500 text-white px-6 py-2 rounded-md hover:bg-slate-600">Ø¥ØºÙ„Ø§Ù‚</button>
                    </div>
                </div>`;
            document.body.appendChild(modalOverlay);
            
            modalOverlay.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal-close') || e.target === modalOverlay) {
                    modalOverlay.remove();
                }
                actions.forEach((action) => {
                    const buttonClass = action.class.split(' ')[0];
                    if (e.target.classList.contains(buttonClass)) {
                        action.callback();
                        if (!action.keepOpen) { 
                            modalOverlay.remove();
                        }
                    }
                });
            });
        }
        
        function selectNewWords() {
            const count = Math.floor(Math.random() * 6) + 15; // 15 to 20 words
            const shuffled = remainingWords.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        async function generateLesson(words, rewrite = false, isRevision = false) {
            if (!apiKey) {
                showModal('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø­ÙØ¸ Ù…ÙØªØ§Ø­ Gemini API Ø£ÙˆÙ„Ø§Ù‹.');
                return;
            }
            isLessonActive = false;
            showScreen(allDOMElements.loadingScreen);

            const prompt = `
            You are an expert Urdu teacher for absolute beginners (A1 level) who speak Arabic. Your task is to create a lesson in URDU using these words: ${words.join(', ')}.

            **EXTREMELY IMPORTANT RULES:**
            1.  **A1 Level ONLY:** You MUST use ONLY very simple Urdu words and grammar. The grammar and sentence structure must also be strictly A1 level.
            2.  **SIMPLE SENTENCES:** Use very simple sentences. For example: "ÛŒÛ Ø§ÛŒÚ© Ú©ØªØ§Ø¨ ÛÛ’" or "Ø¹Ù„ÛŒ Ø§Ø³Ú©ÙˆÙ„ Ø¬Ø§ØªØ§ ÛÛ’".
            3.  **DO NOT USE:** Complex sentences, advanced tenses, or difficult vocabulary. Stick to the Present Simple tense.
            4.  **DIVERSIFY CONTENT:** Randomly choose one style for the main text:
                * **Story (Ú©ÛØ§Ù†ÛŒ):** A simple third-person narrative.
                * **Dialogue (Ù…Ú©Ø§Ù„Ù…Û):** A conversation between two people (use common Urdu names like "Ø¹Ù„ÛŒ", "ÙØ§Ø·Ù…Û"). Format as: "Ø¹Ù„ÛŒ: Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÛŒÚ©Ù…\\nÙØ§Ø·Ù…Û: ÙˆØ¹Ù„ÛŒÚ©Ù… Ø§Ù„Ø³Ù„Ø§Ù…".
                * **Narrative (Ø¨ÛŒØ§Ù†ÛŒÛ):** A simple first-person narrative ("Ù…ÛŒÚº Ø§ÛŒÚ© Ø·Ø§Ù„Ø¨ Ø¹Ù„Ù… ÛÙˆÚº...").
            5.  **JSON FORMAT:** The entire response must be a single, valid JSON object with no extra text. All explanations and translations must be in ARABIC.
            6.  **EXERCISES:** The "question" text must be plain text without any markdown like **. The questions should be in Urdu.

            ${rewrite ? 'Ø£Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù‚ØµØ© ÙˆØ§Ù„ØªÙ…Ø§Ø±ÙŠÙ† ÙÙ‚Ø· Ø¨Ù†ÙØ³ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙˆØ§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©ØŒ Ù…Ø¹ ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ (Ù‚ØµØ©ØŒ Ø­ÙˆØ§Ø±ØŒ Ø³Ø±Ø¯).' : 'Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.'}

            **Required JSON Structure (text in "quotes" must be in Urdu, explanations in Arabic):**
            {
              "story_type": "kahani, mukalma, or bayania",
              "story_mood": "ØµÙØ© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ØªØµÙ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø²Ø§Ø¬ÙŠØ© Ù„Ù„Ù‚ØµØ© (e.g., happy, calm, neutral)",
              "story": "Ø§Ù„Ù†Øµ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¨Ø§Ù„Ø£Ø±Ø¯ÙŠØ© Ù…Ù† 4-5 Ø£Ø³Ø·Ø±. Ù‚Ù… Ø¨ØªÙ…ÙŠÙŠØ² Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© Ø¨ÙˆØ³ÙˆÙ… <b></b>.",
              "new_words": [{"word": "Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ø±Ø¯ÙŠØ©", "translation": "ØªØ±Ø¬Ù…ØªÙ‡Ø§ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"}],
              "grammar_focus": {
                "title": "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù†Ø­ÙˆÙŠØ© (Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)",
                "explanation": "Ø´Ø±Ø­ Ù…Ø·ÙˆÙ„ ÙˆÙ…ÙØµÙ„ Ù„Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¹ Ø³ÙŠØ§Ù‚Ù‡Ø§ ÙˆÙƒÙŠÙ Ø¸Ù‡Ø±Øª ÙÙŠ Ø§Ù„Ù†Øµ.",
                "examples": [
                  {"example": "Ø¬Ù…Ù„Ø© Ù…Ø«Ø§Ù„ Ø¨Ø§Ù„Ø£Ø±Ø¯ÙŠØ©", "translation": "ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø«Ø§Ù„ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"}
                ]
              },
              "useful_structures": [
                {"structure": "Ø§Ù„ØªØ±ÙƒÙŠØ¨ Ù…Ù† Ø§Ù„Ù‚ØµØ© Ø¨Ø§Ù„Ø£Ø±Ø¯ÙŠØ©", "explanation": "Ø´Ø±Ø­ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙˆÙ…Ø¹Ù†Ø§Ù‡ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"}
              ],
              "pronunciation_tips": {
                  "title": "Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ù†Ø·Ù‚ (Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)",
                  "tips": [
                      {"context": "Ø§Ù„ÙƒÙ„Ù…Ø© Ø£Ùˆ Ø§Ù„Ø­Ø±Ù Ø¨Ø§Ù„Ø£Ø±Ø¯ÙŠØ©", "tip": "Ù†ØµÙŠØ­Ø© Ø§Ù„Ù†Ø·Ù‚ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"}
                  ]
              },
              "exercises": [
                {"type": "fill_in_the_blank", "question": "Ø³Ø¤Ø§Ù„ Ø§Ù…Ù„Ø£ Ø§Ù„ÙØ±Ø§Øº Ø¨Ø§Ù„Ø£Ø±Ø¯ÙŠØ© Ù…Ø¹ ___.", "answer": "Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¨Ø§Ù„Ø£Ø±Ø¯ÙŠØ©"},
                {"type": "multiple_choice", "question": "Ø³Ø¤Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯ Ø¨Ø§Ù„Ø£Ø±Ø¯ÙŠØ©.", "options": ["Ø®ÙŠØ§Ø± Ø£", "Ø®ÙŠØ§Ø± Ø¨", "Ø®ÙŠØ§Ø± Ø¬"], "answer": "Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¨Ø§Ù„Ø£Ø±Ø¯ÙŠØ©"},
                {"type": "true_false", "question": "Ø¬Ù…Ù„Ø© Ù„Ù„Ø­ÙƒÙ… Ø¹Ù„ÙŠÙ‡Ø§ Ø¨Ø§Ù„Ø£Ø±Ø¯ÙŠØ©.", "answer": "false"}
              ]
            }
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const result = await response.json();
                const text = result.candidates[0].content.parts[0].text;
                const jsonString = text.replace(/```json/g, '').replace(/```/g, '').trim();
                const lessonData = JSON.parse(jsonString);
                
                if (!rewrite && !isRevision) {
                    learnedWords.push(...words);
                    lessonData.learnedWords = words;
                    lessonData.date = new Date().toLocaleString('ar-EG');
                    lessonHistory.unshift(lessonData);
                    if (lessonHistory.length > 20) lessonHistory.pop();
                    saveState();
                    updateProgress();
                }
                
                renderLesson(lessonData, isRevision);
                isLessonActive = true;
                showScreen(allDOMElements.lessonScreen);

            } catch (error) {
                console.error('Error generating lesson:', error);
                showModal('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯Ø±Ø³. ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ù…ÙØªØ§Ø­ API Ø£Ùˆ Ø¬Ø±Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                showScreen(allDOMElements.homeScreen);
            }
        }
        
        function createSection(title, content, titleControls = '') {
            return `
                <div class="p-5 bg-white rounded-lg shadow-md">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-sky-700">${title}</h3>
                        <div>${titleControls}</div>
                    </div>
                    ${content}
                </div>
            `;
        }

        function renderLesson(data, isRevision = false) {
            const lessonTitle = isRevision ? 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù†Øµ' : '1. Ø§Ù„Ù†Øµ';
            const wordsTitle = isRevision ? 'ÙƒÙ„Ù…Ø§Øª Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' : '2. Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©';

            const storyControls = `
                <button id="read-story-btn" title="Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ ÙƒØ§Ù…Ù„Ø§Ù‹" class="p-2 hover:bg-slate-200 rounded-full transition">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-sky-600"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                </button>
            `;

            const storyContent = `
                <div id="story-container" class="text-2xl font-urdu lesson-content" data-mood="${data.story_mood || 'neutral'}">
                    ${formatStory(data.story, data.story_type)}
                </div>
                <div class="flex items-center justify-center gap-4 mt-4 pt-4 border-t">
                    <label for="line-height-slider" class="text-sm text-slate-600">ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ø£Ø³Ø·Ø±:</label>
                    <input type="range" id="line-height-slider" min="1.5" max="4" step="0.1" value="2.8" class="w-40 cursor-pointer">
                </div>
            `;

            allDOMElements.lessonScreen.innerHTML = `
                ${createSection(lessonTitle, storyContent, storyControls)}
                ${createSection(wordsTitle, createTable(data.new_words, ['Ø§Ù„ÙƒÙ„Ù…Ø©', 'Ø§Ù„Ù…Ø¹Ù†Ù‰'], 'word', 'translation'))}
                ${createSection('3. Ù‚ÙˆØ§Ø¹Ø¯ Ù†Ø³ØªÙÙŠØ¯Ù‡Ø§', renderGrammarSection(data.grammar_focus))}
                ${createSection('4. ØªØ±Ø§ÙƒÙŠØ¨ Ù…ÙÙŠØ¯Ø©', createTable(data.useful_structures, ['Ø§Ù„ØªØ±ÙƒÙŠØ¨', 'Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…'], 'structure', 'explanation'))}
                ${createSection(data.pronunciation_tips.title || '5. Ù†ØµØ§Ø¦Ø­ Ù„Ù„Ù†Ø·Ù‚', renderPronunciationTips(data.pronunciation_tips))}
                ${createSection('6. ØªÙ…Ø§Ø±ÙŠÙ†', renderExercises(data.exercises))}
                <div class="flex flex-col sm:flex-row gap-4 justify-center mt-8">
                    <button id="rewrite-btn" class="bg-amber-500 text-white px-6 py-2 rounded-md hover:bg-amber-600 transition">Ø£Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ù‚ØµØ© Ø¨Ù†ÙØ³ Ø§Ù„ÙƒÙ„Ù…Ø§Øª</button>
                    <button id="next-lesson-btn" class="bg-sky-600 text-white px-6 py-2 rounded-md hover:bg-sky-700 transition">Ø¯Ø±Ø³ Ø¬Ø¯ÙŠØ¯ Ø¨ÙƒÙ„Ù…Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</button>
                </div>
            `;
            
            const slider = document.getElementById('line-height-slider');
            const storyContainer = document.getElementById('story-container');
            
            storyContainer.style.lineHeight = slider.value;
            slider.addEventListener('input', (e) => {
                storyContainer.style.lineHeight = e.target.value;
            });

            document.getElementById('read-story-btn').addEventListener('click', () => {
                const storyText = storyContainer.textContent.trim();
                if (storyText) speakText(storyText);
            });

            document.getElementById('rewrite-btn').addEventListener('click', () => generateLesson(data.learnedWords || data.new_words.map(w => w.word), true, isRevision));
            document.getElementById('next-lesson-btn').addEventListener('click', handleNewLesson);
            document.getElementById('check-answers-btn').addEventListener('click', checkAnswers);
        }
        
        function wrapWordsInSpans(htmlContent) {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlContent;
            
            const walker = document.createTreeWalker(tempDiv, NodeFilter.SHOW_TEXT, null, false);
            let node;
            const textNodes = [];
            while(node = walker.nextNode()) {
                if (node.parentNode.tagName !== 'B' && node.parentNode.tagName !== 'SPAN') {
                     textNodes.push(node);
                }
            }

            textNodes.forEach(node => {
                const parent = node.parentNode;
                const words = node.nodeValue.split(/(\s+)/);
                const fragment = document.createDocumentFragment();
                words.forEach(word => {
                    if (word.trim().length > 0) {
                        const span = document.createElement('span');
                        span.className = 'word-span';
                        span.textContent = word;
                        fragment.appendChild(span);
                    } else {
                        fragment.appendChild(document.createTextNode(word));
                    }
                });
                parent.replaceChild(fragment, node);
            });

            return tempDiv.innerHTML;
        }

        function renderGrammarSection(grammar) {
            if (!grammar) return '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù†Ø­ÙˆÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³.</p>';
            let html = `
                <h4 class="font-bold text-lg mb-2">${grammar.title}</h4>
                <p class="text-slate-600/90 mb-4">${grammar.explanation}</p>
            `;
            if (grammar.examples && grammar.examples.length > 0) {
                html += createTable(grammar.examples, ['Ø§Ù„Ù…Ø«Ø§Ù„', 'Ø§Ù„ØªØ±Ø¬Ù…Ø©'], 'example', 'translation');
            }
            return html;
        }

        function renderPronunciationTips(pronunciation) {
            if (!pronunciation || !pronunciation.tips || pronunciation.tips.length === 0) return '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØµØ§Ø¦Ø­ Ù†Ø·Ù‚ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³.</p>';
            return createTable(pronunciation.tips, ['Ø§Ù„ÙƒÙ„Ù…Ø©/Ø§Ù„Ø­Ø±Ù', 'Ø§Ù„Ù†ØµÙŠØ­Ø©'], 'context', 'tip');
        }

        function formatStory(story, type) {
            const wrappedStory = wrapWordsInSpans(story);
            if (type !== 'mukalma') return wrappedStory;
            
            const speakers = [];
            const lines = wrappedStory.split(/\n|<br>|<br\/>/g);
            return lines.map(line => {
                if (!line.trim()) return '';
                const match = line.match(/^(.*?):/);
                if (match) {
                    let speaker = match[1].replace(/<[^>]*>?/gm, '').trim();
                    let speakerClass = 'dialogue-speaker-1';
                    if (!speakers.includes(speaker)) speakers.push(speaker);
                    if (speakers.indexOf(speaker) % 2 !== 0) speakerClass = 'dialogue-speaker-2';
                    
                    const restOfLine = line.substring(match[0].length);
                    return `<div class="dialogue-line"><span class="${speakerClass}">${speaker}:</span>${restOfLine}</div>`;
                }
                return `<div class="dialogue-line">${line}</div>`;
            }).join('');
        }

        function createTable(data, headers, key1, key2) {
            let tableHTML = '<div class="overflow-x-auto"><table class="table-style">';
            tableHTML += `<thead><tr><th>${headers[0]}</th><th>${headers[1]}</th></tr></thead>`;
            tableHTML += '<tbody>';
            data.forEach(item => {
                tableHTML += `<tr><td class="font-urdu text-lg">${item[key1]}</td><td>${item[key2]}</td></tr>`;
            });
            tableHTML += '</tbody></table></div>';
            return tableHTML;
        }

        function renderExercises(exercises) {
            let html = '<div class="space-y-4">';
            exercises.forEach((ex, index) => {
                const cleanQuestion = ex.question.replace(/\*\*/g, '');
                html += `<div class="exercise p-3 border-r-4 border-slate-200" data-answer="${ex.answer}">`;
                if (ex.type === 'fill_in_the_blank') {
                    html += `<p class="font-urdu text-lg">${index + 1}. ${cleanQuestion.replace('___', '<input type="text" class="exercise-input border-b-2 bg-transparent text-center w-24 mx-1 font-urdu text-lg">')}</p>`;
                } else if (ex.type === 'multiple_choice') {
                    html += `<p class="font-urdu text-lg">${index + 1}. ${cleanQuestion}</p>
                             <div class="flex flex-wrap gap-2 mt-2">
                                ${ex.options.map(opt => `<label class="flex items-center gap-2 p-2 border rounded-md cursor-pointer font-urdu text-lg"><input type="radio" name="ex${index}" value="${opt}" class="exercise-input">${opt}</label>`).join('')}
                             </div>`;
                } else if (ex.type === 'true_false') {
                     html += `<p class="font-urdu text-lg">${index + 1}. ${cleanQuestion}</p>
                              <div class="flex gap-4 mt-2">
                                 <label class="flex items-center gap-2 p-2 border rounded-md cursor-pointer"><input type="radio" name="ex${index}" value="true" class="exercise-input">ØµØ­ÛŒØ­</label>
                                 <label class="flex items-center gap-2 p-2 border rounded-md cursor-pointer"><input type="radio" name="ex${index}" value="false" class="exercise-input">ØºÙ„Ø·</label>
                              </div>`;
                }
                html += '</div>';
            });
            html += '</div><button id="check-answers-btn" class="mt-6 bg-green-600 text-white px-6 py-2 rounded-md hover:bg-green-700">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</button>';
            html += '<div id="results-container" class="mt-4"></div>';
            return html;
        }

        function checkAnswers() {
            const exercises = document.querySelectorAll('.exercise');
            let correctCount = 0;
            exercises.forEach(ex => {
                const correctAnswer = ex.dataset.answer.toLowerCase();
                const inputs = ex.querySelectorAll('.exercise-input');
                let userAnswer = '';
                ex.classList.remove('border-green-400', 'border-red-400');

                if (inputs.length > 0 && inputs[0].type === 'text') {
                    userAnswer = inputs[0].value.trim().toLowerCase();
                } else {
                    inputs.forEach(input => {
                        if (input.checked) {
                            userAnswer = input.value.toLowerCase();
                        }
                    });
                }
                
                if (userAnswer === correctAnswer) {
                    ex.classList.add('border-green-400'); correctCount++;
                } else { 
                    ex.classList.add('border-red-400'); 
                }
            });
            document.getElementById('results-container').innerHTML = `<p class="font-bold">Ù†ØªÙŠØ¬ØªÙƒ: ${correctCount} Ù…Ù† ${exercises.length} Ø¥Ø¬Ø§Ø¨Ø§Øª ØµØ­ÙŠØ­Ø©.</p>`;
        }

        function handleNewLesson() {
            const newWords = selectNewWords();
            if (newWords.length > 0) {
                generateLesson(newWords, false, false);
            } else {
                isLessonActive = false;
                showScreen(allDOMElements.homeScreen);
            }
        }

        function handleRevisionLesson() {
            const wordsForRevision = [...learnedWords].sort(() => 0.5 - Math.random()).slice(0, 15);
            if (wordsForRevision.length > 0) {
                generateLesson(wordsForRevision, false, true);
            }
        }

        function renderHistory() {
            if (lessonHistory.length === 0) {
                allDOMElements.historyList.innerHTML = '<p class="text-center text-slate-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±ÙˆØ³ Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯.</p>';
                return;
            }
            allDOMElements.historyList.innerHTML = lessonHistory.map((lesson, index) => `
                <div class="p-3 border rounded-md hover:bg-slate-100 cursor-pointer" onclick="viewHistoryItem(${index})">
                    <p class="font-bold">Ø¯Ø±Ø³ Ø¨ØªØ§Ø±ÙŠØ®: ${lesson.date}</p>
                    <p class="text-sm text-slate-600 font-urdu">${lesson.learnedWords.slice(0, 5).join('ØŒ ')}...</p>
                </div>
            `).join('');
        }

        function viewHistoryItem(index) {
            const lessonData = lessonHistory[index];
            renderLesson(lessonData, false);
            isLessonActive = true;
            showTab('home');
        }
        
        async function getTranslation(text) {
            const prompt = `Translate the Urdu text "${text}" into a simple, direct Arabic equivalent. Provide only the translation, nothing else.`;
            return await callGeminiForSimpleText(prompt, true);
        }

        async function getPhonetics(text) {
            const prompt = `Ø§ÙƒØªØ¨ Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ„Ù…Ø© Ø£Ùˆ Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„Ø£Ø±Ø¯ÙŠØ© "${text}" Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ø±ÙˆÙ Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¨Ø³Ø·Ø©. ÙÙ‚Ø· Ø£Ø¹Ø· Ø§Ù„Ù†Ø·Ù‚ ÙˆÙ„Ø§ Ø´ÙŠØ¡ Ø¢Ø®Ø±.`;
            return await callGeminiForSimpleText(prompt, true);
        }
        
        async function callGeminiForSimpleText(prompt, hideLoading) {
            if (!apiKey) { showModal('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø­ÙØ¸ Ù…ÙØªØ§Ø­ Gemini API Ø£ÙˆÙ„Ø§Ù‹.'); return null; }
            if (!hideLoading) showScreen(allDOMElements.loadingScreen);
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                if (!response.ok) throw new Error('API Error');
                const result = await response.json();
                if (!hideLoading) showTab(document.querySelector('[id^="nav-"][class*="border-sky-600"]').id.split('-')[1]);
                return result.candidates[0].content.parts[0].text.trim();
            } catch (error) {
                console.error('Error with simple text generation:', error);
                showModal('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.');
                if (!hideLoading) showTab(document.querySelector('[id^="nav-"][class*="border-sky-600"]').id.split('-')[1]);
                return null;
            }
        }

        async function saveToBasket(urduText, arabicText) {
            if (!arabicText) {
                arabicText = await getTranslation(urduText);
                if (!arabicText) {
                     showModal('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªØ±Ø¬Ù…Ø©.');
                     return;
                }
            }

            const isAlreadySaved = learningBasket.some(item => item.ur.toLowerCase() === urduText.toLowerCase());
            if (isAlreadySaved) {
                showModal(`<span class="font-urdu text-lg">"${urduText}"</span> <br><br> Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø³Ù„Ø© Ø§Ù„ØªØ¹Ù„Ù….`);
                return;
            }
            
            learningBasket.unshift({ id: Date.now(), ur: urduText, ar: arabicText });
            saveState();
            showModal(`<span class="font-urdu text-lg">"${urduText}"</span> <br><br> ØªÙ… Ø­ÙØ¸Ù‡Ø§ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Ø³Ù„Ø© Ø§Ù„ØªØ¹Ù„Ù…!`);
        }

        function renderLearnedWords() {
            const container = allDOMElements.learnedWordsScreen;
            const buttonHtml = learnedWords.length >= 15
                ? `<div class="text-center mb-6"><button id="review-lesson-btn" class="bg-sky-600 text-white px-6 py-2 rounded-md hover:bg-sky-700 transition">Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨Ù‚ØµØ© Ø¬Ø¯ÙŠØ¯Ø©</button></div>`
                : `<p class="text-center text-slate-500 mb-6">ØªØ­ØªØ§Ø¬ Ù„ØªØ¹Ù„Ù… ${15 - learnedWords.length} ÙƒÙ„Ù…Ø§Øª Ø£Ø®Ø±Ù‰ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨Ù‚ØµØ©.</p>`;

            const wordsHtml = learnedWords.length === 0 
                ? '<p class="text-center text-slate-500">Ù„Ù… ØªØªØ¹Ù„Ù… Ø£ÙŠ ÙƒÙ„Ù…Ø§Øª Ø¨Ø¹Ø¯. Ø§Ø¨Ø¯Ø£ Ø¯Ø±Ø³Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹!</p>'
                : `<div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    ${[...learnedWords].sort().map(word => `
                        <div class="font-urdu text-lg p-3 border rounded-md text-center cursor-pointer hover:bg-sky-100" onclick="showWordActionModal('${word}')">
                            ${word}
                        </div>
                    `).join('')}
                   </div>`;
            
            container.innerHTML = createSection('Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØªÙŠ ØªØ¹Ù„Ù…ØªÙ‡Ø§', wordsHtml, buttonHtml);

            if (learnedWords.length >= 15) {
                document.getElementById('review-lesson-btn').addEventListener('click', handleRevisionLesson);
            }
        }

        function renderBasket() {
            const basketContainer = allDOMElements.basketScreen;
            if (learningBasket.length === 0) {
                basketContainer.innerHTML = createSection('Ø³Ù„Ø© Ø§Ù„ØªØ¹Ù„Ù…', '<p class="text-center text-slate-500">Ø³Ù„Ù‘ØªÙƒ ÙØ§Ø±ØºØ©. Ø§Ø¨Ø¯Ø£ Ø¨Ø­ÙØ¸ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙˆØ§Ù„Ø¬Ù…Ù„ Ù„Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§ Ù‡Ù†Ø§.</p>');
                return;
            }

            const flashcardsHtml = `
                <div class="flashcard-container">
                    ${learningBasket.map(item => `
                        <div class="flashcard" onclick="this.classList.toggle('is-flipped')">
                            <div class="flashcard-inner">
                                <div class="flashcard-front font-urdu">${item.ur}</div>
                                <div class="flashcard-back">${item.ar}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            const matchingHtml = renderMatchingExercise();

            basketContainer.innerHTML = `
                ${createSection('1. Ø¨Ø·Ø§Ù‚Ø§Øª ØªØ¹Ù„ÙŠÙ…ÙŠØ© (Flashcards)', '<p class="mb-4 text-sm text-slate-500">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„Ù‚Ù„Ø¨Ù‡Ø§ ÙˆØ±Ø¤ÙŠØ© Ø§Ù„ØªØ±Ø¬Ù…Ø©.</p>' + flashcardsHtml)}
                ${createSection('2. ØªÙ…Ø±ÙŠÙ† Ø§Ù„ØªÙˆØµÙŠÙ„', '<p class="mb-4 text-sm text-slate-500">ØµÙ„ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£Ø±Ø¯ÙŠØ© Ø¨ØªØ±Ø¬Ù…ØªÙ‡Ø§ Ø§Ù„ØµØ­ÙŠØ­Ø©.</p>' + matchingHtml)}
            `;
            
            setupMatchingExerciseListeners();
        }
        
        function renderMatchingExercise() {
            const shuffledUr = [...learningBasket].sort(() => 0.5 - Math.random());
            const shuffledAr = [...learningBasket].sort(() => 0.5 - Math.random());

            const urHtml = shuffledUr.map(item => 
                `<div class="match-item font-urdu" data-id="${item.id}">${item.ur}</div>`
            ).join('');
            const arHtml = shuffledAr.map(item => 
                `<div class="match-item" data-id="${item.id}">${item.ar}</div>`
            ).join('');

            return `
                <div class="matching-container">
                    <div class="matching-column">${urHtml}</div>
                    <div class="matching-column">${arHtml}</div>
                </div>
                <p id="match-result" class="text-center font-bold mt-4"></p>
            `;
        }

        function setupMatchingExerciseListeners() {
            let selectedUr = null;
            let selectedAr = null;
            const items = document.querySelectorAll('.match-item');

            items.forEach(item => {
                item.addEventListener('click', () => {
                    const isUrdu = item.classList.contains('font-urdu');
                    
                    if (isUrdu) {
                        if (selectedUr) selectedUr.classList.remove('selected');
                        selectedUr = item;
                        item.classList.add('selected');
                    } else {
                        if (selectedAr) selectedAr.classList.remove('selected');
                        selectedAr = item;
                        item.classList.add('selected');
                    }

                    if (selectedUr && selectedAr) {
                        if (selectedUr.dataset.id === selectedAr.dataset.id) {
                            selectedUr.classList.add('correct');
                            selectedAr.classList.add('correct');
                            document.getElementById('match-result').textContent = 'ØµØ­ÙŠØ­!';
                            document.getElementById('match-result').style.color = 'green';
                        } else {
                            selectedUr.classList.add('incorrect');
                            selectedAr.classList.add('incorrect');
                            document.getElementById('match-result').textContent = 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰!';
                             document.getElementById('match-result').style.color = 'red';
                            setTimeout(() => {
                                selectedUr.classList.remove('incorrect');
                                selectedAr.classList.remove('incorrect');
                            }, 1000);
                        }
                        if (selectedUr) selectedUr.classList.remove('selected');
                        if (selectedAr) selectedAr.classList.remove('selected');
                        selectedUr = null;
                        selectedAr = null;
                    }
                });
            });
        }

        async function speakText(text, mood = 'neutral') {
            resumeAudioContext();
            if (!apiKey || !audioContext) {
                showModal('Ù…ÙŠØ²Ø© Ø§Ù„ØµÙˆØª ØºÙŠØ± Ù…ØªØ§Ø­Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…ÙØªØ§Ø­ API Ø£Ùˆ Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØµÙØ­.');
                return;
            }
            const cleanText = text.replace(/<[^>]*>?/gm, '');
            const randomVoice = ttsVoices[Math.floor(Math.random() * ttsVoices.length)];
            const promptText = `Please say this in Urdu with a standard, clear accent: ${cleanText}`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "gemini-2.5-flash-preview-tts",
                        contents: [{ parts: [{ text: promptText }] }],
                        generationConfig: { 
                            responseModalities: ["AUDIO"],
                            speechConfig: {
                                voiceConfig: {
                                    prebuiltVoiceConfig: { voiceName: randomVoice }
                                }
                            }
                        },
                    })
                });
                if (!response.ok) throw new Error(`TTS API Error: ${response.status}`);
                const result = await response.json();
                const audioData = result?.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;
                if (audioData) {
                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);
                    const wavBlob = pcmToWav(pcm16, 24000);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    new Audio(audioUrl).play();
                } else {
                     throw new Error("No audio data received from API.");
                }
            } catch (error) {
                console.error('Error with TTS:', error);
                showModal('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª. Ù‚Ø¯ Ù„Ø§ ØªØ¯Ø¹Ù… ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù†Ø·Ù‚ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©.');
            }
        }

        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) { bytes[i] = binaryString.charCodeAt(i); }
            return bytes.buffer;
        }

        function pcmToWav(pcmData, sampleRate) {
            const view = new DataView(new ArrayBuffer(44 + pcmData.length * 2));
            writeString(view, 0, 'RIFF'); view.setUint32(4, 36 + pcmData.length * 2, true);
            writeString(view, 8, 'WAVE'); writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true); view.setUint16(20, 1, true);
            view.setUint16(22, 1, true); view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true); view.setUint16(32, 2, true);
            view.setUint16(34, 16, true); writeString(view, 36, 'data');
            view.setUint32(40, pcmData.length * 2, true);
            for (let i = 0; i < pcmData.length; i++) { view.setInt16(44 + i * 2, pcmData[i], true); }
            return new Blob([view], { type: 'audio/wav' });
        }
        
        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        function handleSaveApiKey() {
            const key = allDOMElements.apiKeyInput.value.trim();
            if (key) {
                apiKey = key;
                localStorage.setItem('geminiApiKey_ur', key);
                allDOMElements.apiKeySection.classList.add('hidden');
                allDOMElements.mainContent.classList.remove('hidden');
            } else {
                showModal('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙØªØ§Ø­ API ØµØ­ÙŠØ­.');
            }
        }
        
        function handleResetProgress() {
            const isConfirmed = window.confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„ ØªÙ‚Ø¯Ù…ÙƒØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ÙˆØ§Ù„Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©.');
            if (isConfirmed) {
                learnedWords = [];
                learningBasket = [];
                lessonHistory = [];
                isLessonActive = false;
                saveState();
                updateProgress();
                showTab('home');
            }
        }

        // --- Alphabet Feature Functions ---
        function renderAlphabetScreen() {
            const container = allDOMElements.alphabetScreen;
            const alphabetHtml = urduAlphabet.map(letter => `
                <div class="letter-card font-urdu" data-letter="${letter}">
                    ${letter}
                </div>
            `).join('');

            container.innerHTML = createSection(
                'Ø§Ù„Ø£Ø¨Ø¬Ø¯ÙŠØ© Ø§Ù„Ø£Ø±Ø¯ÙŠØ©',
                '<p class="text-center text-slate-500 mb-6">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ø­Ø±Ù Ù„Ø³Ù…Ø§Ø¹ Ù†Ø·Ù‚Ù‡ ÙˆØªØ¹Ù„Ù… Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù†Ù‡.</p>' + `<div class="alphabet-grid">${alphabetHtml}</div>`
            );
            
            container.querySelectorAll('.letter-card').forEach(card => {
                card.addEventListener('click', handleLetterClick);
            });
        }

        function handleLetterClick(event) {
            const letter = event.currentTarget.dataset.letter;
            getLetterInfo(letter);
        }

        async function getLetterInfo(letter) {
            const prompt = `
            You are an expert Urdu teacher for Arabic speakers.
            Your task is to provide information about a single Urdu letter.
            The letter is: "${letter}"

            **RULES:**
            1.  Provide the information in a clear, simple format for a beginner.
            2.  The entire response must be a single, valid JSON object.
            3.  All text values in the JSON must be in Arabic, except for the letter and example word.

            **Required JSON Structure:**
            {
              "letter_name": "Ø§Ø³Ù… Ø§Ù„Ø­Ø±Ù (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ù)",
              "pronunciation_guide": "Ø´Ø±Ø­ Ù„ÙƒÙŠÙÙŠØ© Ù†Ø·Ù‚ Ø§Ù„Ø­Ø±ÙØŒ Ù…Ø¹ Ù…Ù‚Ø§Ø±Ù†ØªÙ‡ Ø¨ØµÙˆØª Ø¹Ø±Ø¨ÙŠ Ù…Ø´Ø§Ø¨Ù‡ Ø¥Ù† Ø£Ù…ÙƒÙ†.",
              "example_word": "ÙƒÙ„Ù…Ø© Ù…Ø«Ø§Ù„ ØªØ¨Ø¯Ø£ Ø¨Ø§Ù„Ø­Ø±Ù (Ø¨Ø§Ù„Ø£Ø±Ø¯ÙŠØ©)",
              "example_word_translation": "ØªØ±Ø¬Ù…Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø«Ø§Ù„ (Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)"
            }
            `;
            
            const letterData = await callGeminiForSimpleText(prompt, false);
            if (letterData) {
                try {
                    const parsedData = JSON.parse(letterData);
                    const modalContent = `
                        <div class="text-right space-y-4">
                            <p><strong class="font-bold">Ø§Ø³Ù… Ø§Ù„Ø­Ø±Ù:</strong> ${parsedData.letter_name}</p>
                            <p><strong class="font-bold">ÙƒÙŠÙÙŠØ© Ø§Ù„Ù†Ø·Ù‚:</strong> ${parsedData.pronunciation_guide}</p>
                            <hr>
                            <p class="text-lg"><strong class="font-bold">Ù…Ø«Ø§Ù„:</strong> <span class="font-urdu text-2xl">${parsedData.example_word}</span> (${parsedData.example_word_translation})</p>
                        </div>
                    `;
                    
                    const actions = [{
                        text: `ğŸ”Š Ù†Ø·Ù‚ Ø§Ù„Ø­Ø±Ù`,
                        class: 'speak-letter-btn bg-sky-500 text-white hover:bg-sky-600',
                        callback: () => speakText(letter),
                        keepOpen: true
                    }, {
                        text: `ğŸ”Š Ù†Ø·Ù‚ Ø§Ù„Ù…Ø«Ø§Ù„`,
                        class: 'speak-example-btn bg-green-500 text-white hover:bg-green-600',
                        callback: () => speakText(parsedData.example_word),
                        keepOpen: true
                    }];

                    showModal(modalContent, `ØªØ¹Ù„Ù… Ø­Ø±Ù <span class="font-urdu text-3xl">${letter}</span>`, actions);
                } catch(e) {
                    console.error("Failed to parse letter info JSON", e);
                    showModal("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø±Ù.");
                }
            }
        }

        initialize();
    </script>
</body>
</html>
